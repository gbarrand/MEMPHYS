<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&lt;h1&gt;10.x on iridium&lt;/h1&gt;</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><h1>10.x on iridium</h1>
</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="memphys_iridium_binary_distrib"></a>
Binary distribution</h1>
<p>The build system produces a "distrib" binary packing intended to be an all-in-one binary distribution ready to be installed and used with a mimimal of steps. Must be pointed out that a binary distrib is not a source distribution, and that someone has nothing to compile and link with a binary distribution. Obviously, you have to check that the binary is compatible with the targeted machine.</p>
<p>On iridiumm, there are two binary distributions : </p><pre class="fragment">    /nfs/users/gbarrand/usr/local/MEMPHYS-10.0.0-Linux-x86_64-gcc_493.zip
    /nfs/users/gbarrand/usr/local/MEMPHYS-9.0.0-Linux-x86_64-gcc_447.zip
</pre><p> The first one had been built with a gcc-4.9.3 and a geant4-10.03.p01 found under : </p><pre class="fragment">    /cvmfs/sft.cern.ch/lcg/releases/LCG_88/gcc/4.9.3/x86_64-slc6/
    /nfs/users/gbarrand/usr/local/geant4/10.03.p01  (then built on an iridium front-end machine).
</pre><p> The second one had been built with the local gcc-4.4.7 and a geant4-8.2 found under : </p><pre class="fragment">    /nfs/users/gbarrand/usr/local/geant4/9.2  (then built on an iridium front-end machine).
</pre><p>There are unfolded/installed versions under : </p><pre class="fragment">    /nfs/users/gbarrand/usr/local/MEMPHYS/10.0.0
    /nfs/users/gbarrand/usr/local/MEMPHYS/9.0.0
</pre><p> but as the MEMPHYS_sim program produces the MEMPHYS.root file, and that these areas are not writable to all, you have to install a binary distrib kit under an area where you have a write access. We are going to give instructions to do that on a MEMPHYS/10.0.0.</p>
<h1><a class="anchor" id="memphys_iridium_install_run_binary_distrib"></a>
Install and run a binary distribution</h1>
<p>Then to install a MEMPHYS/10.0.0 : </p><pre class="fragment">    iridium&gt; cd &lt;where you have write access&gt;
    iridium&gt; cp  /nfs/users/gbarrand/usr/local/MEMPHYS-10.0.0-Linux-x86_64-gcc_493.zip .
    iridium&gt; unzip -q MEMPHYS-10.0.0-Linux-x86_64-gcc_493.zip
</pre><p> and to run MEMPHYS_sim : </p><pre class="fragment">    iridium&gt; cd MEMPHYS/10.0.0
</pre><p> you have to "source setup" the g++-493 and "geant4 data" run time environment : </p><pre class="fragment">  if being under a sh flavoured shell :
    iridium&gt; . ./gcc_493_setup.sh
    iridium&gt; . ./setenv_g4data.sh
  or if being under a csh flavoured shell :
    iridium&gt; source ./gcc_493_setup.csh
    iridium&gt; source ./setenv_g4data.csh
</pre><p> then : </p><pre class="fragment">    iridium&gt; cd exa_run
    iridium&gt; ../bin/MEMPHYS_sim
</pre><p> The default run setup executes 10 events. But you ca execute more or less events (for exa 2) with : </p><pre class="fragment">    iridium&gt; ../bin/MEMPHYS_sim -events=2
</pre><p> The program produces the MEMPHYS.root file containing some used geometry infos and data according to a simple event model. The files init.g4m, job_options.mac permit some tuning on Geant4 (for example verbosity). The file input.memphys contains twelve "vertices" of neutrino interactions to be "tracked" by Geant4 (one per Geant4 event). The input.memphys format is an ascii file format specific to MEMPHYS (see the <a href="memphys_input_memphys.html">input.memphys</a> section for more).</p>
<h1><a class="anchor" id="memphys_iridium_slurm"></a>
Running a SLURM job</h1>
<p>In the exa_run directory there is the Bourne shell script "sim_slurm" ready to run MEMPHYS_sim on threee nodes of iridium : </p><pre class="fragment">    iridium&gt; sinfo
    iridium&gt; sbatch ./sim_slurm
    iridium&gt; squeue
    iridium&gt; more slurm*.out
</pre><p> The job produces MEMPHYS_[job-id]_[task-id].root files along slurm-[job-id]_[task-id].out for stdout output. Then with the default sim_slurm script you should have three MEMPHYS.root files and three slurm output files.</p>
<h1><a class="anchor" id="memphys_iridium_plots"></a>
Have some plots</h1>
<p>To do some analysis and have a couple of plots on a MEMPHYS.root file produced by the MEMPHYS_sim program : </p><pre class="fragment">    iridium&gt; ../bin/MEMPHYS_read_plot_offscreen                  # on the default MEMPHYS.root file.
    iridium&gt; ../bin/MEMPHYS_read_plot                            # on the default MEMPHYS.root file.
    iridium&gt; ../bin/MEMPHYS_read_plot MEMPHYS_&lt;job&gt;_&lt;task&gt;.root  # on a MEMPHYS root file produced by a slurm task.
</pre><p>The MEMPHYS_read_plot_offscreen program produces read_plot_offscreen[.png,.ps,_zb.ps] files without the need to tie to any interactive GUI and graphics system. The MEMPHYS_read_plot does the plotting by using X11 and OpenGL (GL-ES in fact), then you need to have a working X11 server, and the DISPLAY environment variable set properly. Note that the two upper programs do not use CERN-ROOT at all. They use the inlib/rroot code to read back the MEMPHYS.root file and the inlib/exlib sg classes to do the graphics and then the plotting ("sg" is for scene graph). (inlib and exlib are part of the softinex software started around 2010 to do HEP related graphics, not only on laptops and desktops, but also on smartphones and tablets).</p>
<h1><a class="anchor" id="memphys_iridium_binary_distrib_cern_root"></a>
plotting with CERN-ROOT</h1>
<p>Note that CERN-ROOT is not used by the MEMPHYS_sim, MEMPHYS_read_plot_offscreen, MEMPHYS_read_plot programs at all. CERN-ROOT is not needed to compile and link these programs. The MEMPHYS.root file is produced by using the inlib/wroot classes. (The inlib/wroot classes are the same one found in Geant4/source/analysis/g4tools code, wiht the namespace "inlib" replaced by "tools" for consistency reason within Geant4. The g4tools code being used within Geant4 examples to create histos and ntuples and save them in files at various format as the CERN-ROOT format but also at the csv format).</p>
<p>On iridium, we have installed a CERN-ROOT working with the default compiler under : </p><pre class="fragment">     /nfs/users/gbarrand/usr/local/ROOT/5.34.00.patches
</pre><p> To analyse a MEMPHYS.root file with this version of CERN-ROOT, you have to "source setup" it : </p><pre class="fragment">  if being under a sh flavoured shell :
    iridium&gt; . ../cern_root_setup.sh
  or if being under a csh flavoured shell :
    iridium&gt; source ../cern_root_setup.csh
</pre><p> and then : </p><pre class="fragment">    UNIX&gt; root analysis.C                                  # on the default MEMPHYS.root file.
    UNIX&gt; root -file=MEMPHYS_&lt;job&gt;_&lt;task&gt;.root analysis.C  # on a MEMPHYS root file produced by a slurm task.
</pre><p>A long experience showed that a lot of problems may happen by using the CERN-ROOT interpreter (CINT in the ROOT-5.x and now cling-clang in the ROOT-6.x). If so you may try with the compiled program MEMPHYS_read_plot_ROOT that read MEMPHYS.root with inlib/rroot classes and does the histogramming and plotting with CERN-ROOT (by using TH1D, TCanvas and all that) : </p><pre class="fragment">    UNIX&gt; ../bin/MEMPHYS_read_plot_ROOT                            # on the default MEMPHYS.root file.
    UNIX&gt; ../bin/MEMPHYS_read_plot_ROOT MEMPHYS_&lt;job&gt;_&lt;task&gt;.root  # on a MEMPHYS root file produced by a slurm task.
</pre><p> or with MEMPHYS_all_ROOT that read also the event model with CERN-ROOT/TTree : </p><pre class="fragment">    UNIX&gt; ../bin/MEMPHYS_all_ROOT                                  # on the default MEMPHYS.root file.
    UNIX&gt; ../bin/MEMPHYS_all_ROOT -file=MEMPHYS_&lt;job&gt;_&lt;task&gt;.root  # on a MEMPHYS root file produced by a slurm task.
</pre><h1><a class="anchor" id="memphys_iridium_source_distrib"></a>
To build from source</h1>
<p>A checkout of the "branch" version_10_0_0 from the git repository : </p><pre class="fragment">     https://github.com/gbarrand/MEMPHYS.git
</pre><p> is under : </p><pre class="fragment">    /nfs/users/gbarrand/public/MEMPHYS
</pre><p> To customize and build, have a copy of it and follow instructions found in the "Build from source" section. In principle all is ready for a build using the geant4 and CERN-ROOT found under : </p><pre class="fragment">    /nfs/users/gbarrand/usr/local
</pre><p> To work with your own copy of these, you will have to customize : </p><pre class="fragment">    MEMPHYS/MEMPHYS/mgr/use_geant4
    MEMPHYS/MEMPHYS/mgr/cern_root_setup.sh
    MEMPHYS/MEMPHYS/mgr/cern_root_setup.csh
</pre><p> Note that the build is done by using Bourne shell scripts. The : </p><pre class="fragment">    MEMPHYS/MEMPHYS/mgr/build
    MEMPHYS/MEMPHYS/mgr/build_lib_MEMPHYSCore
    MEMPHYS/MEMPHYS/mgr/build_app_sim
    MEMPHYS/MEMPHYS/mgr/build_app_...
</pre><p> rely on scripts found under : </p><pre class="fragment">    MEMPHYS/bush
</pre><p> "bush" is for "BUild with (Bourne) SHell". It is a set of Bourne shell scripts. It is a rather simple and rustic build system compared to various other build systems around now (in particular cmake). For the story, it had been developed to be able to build graphics applications from a prompt on very heterogeneous platforms by using their local capabilites. In particular it permits to build on Windows from a CYGWIN prompt by using the Microsoft VisualC++ compiler but by avoiding the VisualStudio IDE, and also to build macOS/Cocoa apps without having to pass by the Xcode IDE. (It is hard, for the same app, to maintain various IDEs). Right now the MEMPHYS source distrib does not contain the visualization application, but it is foreseen to have it soon...</p>
<p>If having problem with the compiler and access to some package, the files to look/customize are : </p><pre class="fragment">    MEMPHYS/bush/use_cpp, use_cc.
    MEMPHYS/bush/use/&lt;package&gt;
</pre><p> In particular, since all is in a well known scripting language, it is rather easy to tweak things in case of problem. See the bush section on the softinex portal for more.</p>
<p>For people attached to another build system, the MEMPHYS_sim program itself relies only on : </p><pre class="fragment">    MEMPHYS/MEMPHYS/MEMPHYS/*.hh
    MEMPHYS/MEMPHYS/source/*.cpp
    MEMPHYS/MEMPHYS/applications/sim.cpp
    geant4 includes and archive libs
</pre><p> for the simulation itself, and zlib and the inlib pure header code to produce the MEMPHYS.root file. (These are found under MEMPHYS/inexlib/inlib and MEMPHYS/inexlib/ourex/zlib). It should not be too hard to duplicate the build done by the build_app_sim Bourne shell script to build MEMPHYS_sim with something else. (In particular, if wanting to build with cmake, by cloning the CMakeLists.txt file found now in any Geant4 example). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->

</body>
</html>
